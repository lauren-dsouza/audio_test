<!-- Portfolio Grid Section -->
<section id="portfolio" class="bg-light-gray">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 class="section-heading">Portfolio</h2>
                <h3 class="section-subheading text-muted">Lorem ipsum dolor sit amet consectetur.</h3>
            </div>
        </div>
        <div class="row">
        {% for post in site.posts %}
            <div class="col-md-4 col-sm-6 portfolio-item">
                <a href="#portfolioModal{{ post.modal-id }}" class="portfolio-link" data-toggle="modal">
                    <div class="portfolio-hover">
                        <div class="portfolio-hover-content">
                            <i class="fa fa-plus fa-3x"></i>
                        </div>
                    </div>
                    <img src="img/portfolio/{{ post.thumbnail }}" class="img-responsive img-centered" alt="">
                </a>
                <div class="portfolio-caption">
                    <h4>{{ post.title }}</h4>
                    <p class="text-muted">{{ post.subtitle }}</p>
                    <!-- Add audio recording button -->
                    <button onclick="startRecording('{{ post.title }}')" class="btn btn-primary">Start Recording</button>
                </div>
            </div>
        {% endfor %}
        </div>
    </div>
</section>

<!-- Audio Recorder -->
<audio controls id="audioPlayback"></audio>

<script>
    let audioChunks = [];
    let mediaRecorder;
    const audioPlayback = document.getElementById('audioPlayback');

    async function startRecording(title) {
        audioChunks = [];
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.addEventListener('dataavailable', event => {
                audioChunks.push(event.data);
            });

            mediaRecorder.addEventListener('stop', () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                const audioUrl = URL.createObjectURL(audioBlob);
                audioPlayback.src = audioUrl;
                // Add logic to save the audio recording along with the portfolio item
                alert('Audio recording saved for ' + title);
            });

            mediaRecorder.start();
        } catch (err) {
            console.error('Error starting recording: ', err);
        }
    }
</script>
